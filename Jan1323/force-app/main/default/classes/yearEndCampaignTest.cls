//Code by Jessie Rymph
//January 12, 2023
//Tests the Year End Gift Campaign process using the YearEndtestDataFactory class
//https://wp.me/p9qPLI-1q8

//Code by Jessie Rymph
//December 30, 2021
//Tests the Year End Gift Campaign process using the YearEndtestDataFactory class
//https://wp.me/p9qPLI-1q8

@isTest
public class yearEndCampaignTest {
    @isTest static void positiveTest() {
        // Test data setup
        // Create contacts with opps through test utility
        Integer testNumC= 10;
        Integer testNumO = 10;
        contact[] cons = YearEndTestDataFactory.giftsLastYear(testNumC,testNumO);
        
        Test.startTest();
        	yearEndCampaignTable yEGB = new yearEndCampaignTable();
        	Id batchId = Database.executeBatch(yEGB);
        Test.stopTest();        
        List<Contact> contacts = new List<Contact>();

        for(Contact person : [SELECT Id, Gifts_Last_Year__c FROM Contact]) {
            if(person.Gifts_Last_Year__c.contains('Campaign')) {
                contacts.add(person);
            }
        }
        System.assertEquals(testNumC,contacts.size(),testNumC +' ');
       
    }
    
    @isTest static void negativeTest() {
        // Test data setup
        // Create contacts with opps through test utility for current year
        Integer testNumC=10;
        Integer testNumO = 5;
        contact[] cons = YearEndTestDataFactory.giftsThisYear(testNumC,testNumO);
        
        Test.startTest();
        	yearEndCampaignTable yEGB = new yearEndCampaignTable();
        	Id batchId = Database.executeBatch(yEGB);
        Test.stopTest();        
        List<Contact> contacts = new List<Contact>();

        for(Contact person : [SELECT Id, Gifts_Last_Year__c FROM Contact]) {
           
            IF(person.Gifts_Last_Year__c != null) { 
                contacts.add(person);
            }
            
        }
        System.assertEquals(0,contacts.size(),'Expected none, got' + contacts.size());

    }
    

    @IsTest
    static void testThatEmailWasSent(){
        Integer testNumC= 5;
        Integer testNumO = 5;
        contact[] cons = YearEndTestDataFactory.giftsLastYear(testNumC,testNumO);
        
        Test.startTest();
        //System.assertEquals(0, Limits.getEmailInvocations(), 'No emails should be sent');
        yearEndCampaignTable yEGB = new yearEndCampaignTable();  	
        Id batchId = Database.executeBatch(yEGB);
        Test.stopTest();
		System.assertEquals(1,yearendCampaignTable.emaillimits);
    }
}